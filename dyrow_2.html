<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Test</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="res/lib/jquery/1.8.3/jquery.js" ></script>
<script>

;(function($) {
    $.fn.extend({
        dyRow : function(options) {
            
            var defaults = {
                removeClass: '.row-remover',
                cloneClass: '.row-cloner',
                addRowTemplateId: '#add-template',
                addRowButtonId: '#add-row',
                lastRowRemovable: false,  //是否允许删除最后一条
                onRowRemove: function(){},
                onRowClone: function(){},
                onRowAdd: function(){},
                onTableEmpty: function(){}
            };     
            
            options = $.extend(defaults, options);

            var insertRow = function(clonedRow, tbod) {                  
                $(tbod).append( clonedRow );
            }
            var cloneRow = function(btn) {
                var clonedRow = $(btn).closest('tr').clone();  
                var tbod = $(btn).closest('tbody');
                insertRow(clonedRow, tbod); 
                options.onRowClone();
            }
            var removeRow = function(btn) {
                var tbod = $(btn).closest('tbody');
                var numRows = $(tbod).children("tr").length;
                if(numRows > 1 || options.lastRowRemovable === true) {
                    var trToRemove = $(btn).closest('tr');
                    $(trToRemove).fadeOut("fast" , function() {
                        $(trToRemove).remove();
                        options.onRowRemove();
                        if(numRows == 1) {
                            options.onTableEmpty();
                        }
                    });
                }                            
            }
            return this.each(function() {
                if(this.nodeName.toLowerCase() == 'table') {                                
                    var table = $(this);                        
                    $(options.addRowButtonId).click(function(){
                        var newTr = $(options.addRowTemplateId).val();
                        var tbody = $(table).children("tbody").first();
                        insertRow(newTr, tbody);
                        options.onRowAdd();
                        return false;
                    });
                    $(table).on("click", options.cloneClass ,function(){
                        var btn = this;
                        cloneRow(btn);
                    });
                    $(table).on("click", options.removeClass ,function(){
                        var btn = this;
                        removeRow(btn);
                    });
                }
            })
        }
    })
})(jQuery);

$(function(){
    //table1:
    $("#tradeRecordsIndex").dyRow();
    //table2:
    $("#tradeRecordsIndex2").dyRow({
        addRowTemplateId: '#T-template',
        addRowButtonId: '#add-btn-2',
        lastRowRemovable: false,
        onRowRemove: function(){
            console.log('onRowRemove');
        },
        onRowClone: function(){
            console.log('onRowClone');
        },
        onRowAdd: function(){
            console.log('onRowAdd');
        },
        onTableEmpty: function(){ //当"lastRowRemovable"为true时才有效
            console.log('onTableEmpty');
        } 
    });
})
</script>
</head>
<body>
<h2>表格1：</h2>
<div>
	<table id="tradeRecordsIndex" class="ui-record-table" width="50%">
		<colgroup>
			<col width="25%">
			<col width="25%">
			<col width="">
			<col width="18">
			<col width="18">
		</colgroup>
		<thead>
			<tr>
				<th >IMEI串号</th>
				<th >品牌</th>
				<th >颜色</th>
                <th colspan="2">操作</th>
            </tr>
		</thead>
		<tbody >

		</tbody>
	</table>
</div>
<a id="add-row" href="#">添加一行</a>

<textarea id="add-template" style="display:none;">
<tr >
    <td>
        <input type="text" value="请输入imei号"/>
    </td>
    <td>
        <select>
            <option>请选择品牌</option>
            <option>三星</option>
            <option>苹果</option>
        </select>
    </td>
    <td>
        <select>
            <option>请选择颜色</option>
            <option>白</option>
            <option>黑</option>
        </select>
    </td>
    <td>
        <img class="row-cloner" src="img/clone.png" alt="Clone Row" />                        
    </td>
    <td>
        <img class="row-remover" src="img/remove.png" alt="Remove Row" />
    </td>
</tr>
</textarea>




<h2>表格2：</h2>
<div>
    <table id="tradeRecordsIndex2" class="ui-record-table" width="50%">
        <colgroup>
            <col width="25%">
            <col width="25%">
            <col width="">
            <col width="18">
            <col width="18">
        </colgroup>
        <thead>
            <tr>
                <th >IMEI串号</th>
                <th >品牌</th>
                <th >颜色</th>
                <th colspan="2">操作</th>
            </tr>
        </thead>
        <tbody >

        </tbody>
    </table>
</div>
<a id="add-btn-2" href="#">添加一行</a>
<textarea id="T-template" style="display:none;">
<tr >
    <td>
        <input type="text" value="请输入imei号"/>
    </td>
    <td>
        <select>
            <option>请选择品牌</option>
            <option>三星</option>
            <option>苹果</option>
        </select>
    </td>
    <td>
        <select>
            <option>请选择颜色</option>
            <option>白</option>
            <option>黑</option>
        </select>
    </td>
    <td>
        <img class="row-cloner" src="img/clone.png" alt="Clone Row" />                        
    </td>
    <td>
        <img class="row-remover" src="img/remove.png" alt="Remove Row" />
    </td>
</tr>
</textarea>

</body>
</html>
